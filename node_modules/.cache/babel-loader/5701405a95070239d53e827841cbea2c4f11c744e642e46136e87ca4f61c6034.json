{"ast":null,"code":"// src/services/nutritionService.js\nclass NutritionService {\n  constructor() {\n    // Use proxy server instead of direct API calls\n    this.proxyUrl = process.env.REACT_APP_PROXY_URL || \"http://localhost:3001/api/claude\";\n    this.model = \"claude-sonnet-4-20250514\";\n  }\n\n  // Make API call to Claude via proxy server\n  async callClaude(prompt, maxTokens = 2000) {\n    try {\n      console.log('Making request to proxy server:', this.proxyUrl);\n      const response = await fetch(this.proxyUrl, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          model: this.model,\n          max_tokens: maxTokens,\n          messages: [{\n            role: \"user\",\n            content: prompt\n          }]\n        })\n      });\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(`Proxy request failed: ${response.status} - ${errorData.error || 'Unknown error'}`);\n      }\n      const data = await response.json();\n      const responseText = data.content[0].text;\n\n      // Clean response and parse JSON\n      const cleanedResponse = responseText.replace(/```json\\n?/g, \"\").replace(/```\\n?/g, \"\").trim();\n      return JSON.parse(cleanedResponse);\n    } catch (error) {\n      console.error('Claude API Error:', error);\n      throw error;\n    }\n  }\n\n  // Test proxy connection\n  async testConnection() {\n    try {\n      const healthUrl = this.proxyUrl.replace('/api/claude', '/health');\n      const response = await fetch(healthUrl);\n      const data = await response.json();\n      console.log('Proxy server health:', data);\n      return data.status === 'OK' && data.hasApiKey;\n    } catch (error) {\n      console.error('Proxy connection test failed:', error);\n      return false;\n    }\n  }\n\n  // Generate personalized nutrition plan using Claude\n  async generateNutritionPlan(userData) {\n    console.log('Generating nutrition plan for:', userData);\n    try {\n      const prompt = this.buildNutritionPrompt(userData);\n      const response = await this.callClaude(prompt, 2000);\n      console.log('✅ Received Claude nutrition plan');\n      return response;\n    } catch (error) {\n      console.error('❌ Error generating nutrition plan:', error);\n      console.log('🔄 Falling back to intelligent mock data');\n      // Fallback to intelligent mock data\n      return this.generateIntelligentMockPlan(userData);\n    }\n  }\n\n  // Generate weekly meal plan using Claude\n  async generateWeeklyMealPlan(userData, nutritionPlan) {\n    console.log('Generating weekly meal plan for:', userData);\n    try {\n      const prompt = this.buildMealPlanPrompt(userData, nutritionPlan);\n      const response = await this.callClaude(prompt, 3000);\n      console.log('✅ Received Claude meal plan');\n      return response;\n    } catch (error) {\n      console.error('❌ Error generating meal plan:', error);\n      console.log('🔄 Falling back to mock meal plan');\n      // Fallback to mock meal plan\n      return this.generateMockMealPlan(userData, nutritionPlan);\n    }\n  }\n\n  // Generate daily nutrition recommendations using Claude\n  async generateDailyNutrition(userData) {\n    console.log('Generating daily nutrition for:', userData);\n    try {\n      const prompt = this.buildDailyNutritionPrompt(userData);\n      const response = await this.callClaude(prompt, 1500);\n      console.log('✅ Received Claude daily nutrition');\n      return response;\n    } catch (error) {\n      console.error('❌ Error generating daily nutrition:', error);\n      console.log('🔄 Falling back to mock daily nutrition');\n      // Fallback to mock daily nutrition\n      return this.generateMockDailyNutrition(userData);\n    }\n  }\n\n  // Build detailed nutrition plan prompt for Claude\n  buildNutritionPrompt(userData) {\n    var _trainingData$todaysA, _trainingData$todaysA2, _trainingData$todaysA3, _trainingData$todaysA4;\n    const {\n      athlete,\n      trainingData,\n      activities,\n      preferences\n    } = userData;\n    return `Create a personalized nutrition plan based on the following athlete data.\n\nATHLETE PROFILE:\n- Name: ${athlete === null || athlete === void 0 ? void 0 : athlete.firstname} ${athlete === null || athlete === void 0 ? void 0 : athlete.lastname}\n- Weight: ${(athlete === null || athlete === void 0 ? void 0 : athlete.weight) || preferences.weight || 70}kg\n- Gender: ${(athlete === null || athlete === void 0 ? void 0 : athlete.sex) === 'M' ? 'Male' : (athlete === null || athlete === void 0 ? void 0 : athlete.sex) === 'F' ? 'Female' : 'Unknown'}\n- Age: ${preferences.age || 35}\n- Height: ${preferences.height || 175}cm\n\nCURRENT TRAINING DATA:\n- Training Phase: ${trainingData === null || trainingData === void 0 ? void 0 : trainingData.currentPhase}\n- Weekly TSS: ${trainingData === null || trainingData === void 0 ? void 0 : trainingData.weeklyTSS}\n- Recent Activity: ${trainingData === null || trainingData === void 0 ? void 0 : (_trainingData$todaysA = trainingData.todaysActivity) === null || _trainingData$todaysA === void 0 ? void 0 : _trainingData$todaysA.type} (${trainingData === null || trainingData === void 0 ? void 0 : (_trainingData$todaysA2 = trainingData.todaysActivity) === null || _trainingData$todaysA2 === void 0 ? void 0 : _trainingData$todaysA2.duration} min, ${trainingData === null || trainingData === void 0 ? void 0 : (_trainingData$todaysA3 = trainingData.todaysActivity) === null || _trainingData$todaysA3 === void 0 ? void 0 : _trainingData$todaysA3.intensity} intensity, ${trainingData === null || trainingData === void 0 ? void 0 : (_trainingData$todaysA4 = trainingData.todaysActivity) === null || _trainingData$todaysA4 === void 0 ? void 0 : _trainingData$todaysA4.tss} TSS)\n\nRECENT ACTIVITIES (Last 7 days):\n${activities === null || activities === void 0 ? void 0 : activities.slice(0, 7).map(activity => `- ${activity.date}: ${activity.type}, ${activity.duration} min, ${activity.intensity} intensity, ${activity.tss} TSS`).join('\\n')}\n\nGOALS & PREFERENCES:\n- Primary Goal: ${preferences.trainingGoal || 'Endurance Performance'}\n- Dietary Restrictions: ${preferences.dietaryRestrictions || 'None'}\n\nCONTEXT: This athlete is actively training with real Strava data. Analyze their training patterns, intensity distribution, and current phase to provide highly specific nutrition recommendations.\n\nRespond ONLY with valid JSON in this exact format:\n\n{\n  \"dailyCalories\": number,\n  \"macros\": {\n    \"carbs\": { \"grams\": number, \"percentage\": number, \"timing\": \"specific timing recommendations\" },\n    \"protein\": { \"grams\": number, \"percentage\": number, \"timing\": \"specific timing recommendations\" },\n    \"fat\": { \"grams\": number, \"percentage\": number, \"timing\": \"specific timing recommendations\" }\n  },\n  \"hydration\": {\n    \"dailyTarget\": number,\n    \"duringTraining\": \"specific ml per hour based on training duration\",\n    \"recoveryFocus\": \"specific hydration strategy\"\n  },\n  \"workoutNutrition\": {\n    \"preWorkout\": \"specific food and timing based on upcoming workout\",\n    \"duringWorkout\": \"specific fueling strategy for their training intensity\", \n    \"postWorkout\": \"specific recovery nutrition with timing\"\n  },\n  \"mealSuggestions\": [\n    {\n      \"meal\": \"Breakfast\",\n      \"description\": \"specific meal based on training schedule\",\n      \"calories\": number,\n      \"timing\": \"specific timing relative to training\"\n    },\n    {\n      \"meal\": \"Pre-Training\",\n      \"description\": \"specific pre-workout meal\",\n      \"calories\": number,\n      \"timing\": \"specific timing\"\n    },\n    {\n      \"meal\": \"Post-Training\",\n      \"description\": \"specific recovery meal\",\n      \"calories\": number,\n      \"timing\": \"specific timing\"\n    },\n    {\n      \"meal\": \"Dinner\",\n      \"description\": \"specific dinner based on training load\",\n      \"calories\": number,\n      \"timing\": \"specific timing\"\n    }\n  ],\n  \"supplements\": [\n    {\n      \"name\": \"supplement name\",\n      \"dosage\": \"specific dosage\",\n      \"timing\": \"specific timing\",\n      \"purpose\": \"specific purpose for this athlete's training\"\n    }\n  ],\n  \"notes\": \"Key insights about this athlete's specific training phase, recent activities, and personalized recommendations\"\n}\n\nDO NOT OUTPUT ANYTHING OTHER THAN VALID JSON.`;\n  }\n\n  // Build meal plan prompt for Claude\n  buildMealPlanPrompt(userData, nutritionPlan) {\n    const {\n      athlete,\n      trainingData,\n      activities,\n      preferences\n    } = userData;\n    return `Create a 7-day meal plan based on this athlete's nutrition plan and training schedule.\n\nATHLETE: ${athlete === null || athlete === void 0 ? void 0 : athlete.firstname} (${(athlete === null || athlete === void 0 ? void 0 : athlete.weight) || 70}kg)\nNUTRITION TARGETS:\n- Daily Calories: ${nutritionPlan.dailyCalories}\n- Carbs: ${nutritionPlan.macros.carbs.grams}g (${nutritionPlan.macros.carbs.percentage}%)\n- Protein: ${nutritionPlan.macros.protein.grams}g (${nutritionPlan.macros.protein.percentage}%)\n- Fat: ${nutritionPlan.macros.fat.grams}g (${nutritionPlan.macros.fat.percentage}%)\n\nTRAINING PATTERN (analyze for meal timing):\n${activities === null || activities === void 0 ? void 0 : activities.slice(0, 7).map((activity, index) => `Day ${index + 1}: ${activity.type}, ${activity.duration}min, ${activity.intensity} intensity`).join('\\n')}\n\nPREFERENCES:\n- Dietary Restrictions: ${preferences.dietaryRestrictions || 'None'}\n- Cooking Skill: ${preferences.cookingSkill || 'Intermediate'}\n\nCreate meals that:\n1. Match training demands (higher carbs on hard training days)\n2. Optimize timing around workouts\n3. Meet nutritional targets\n4. Are practical and enjoyable\n\nRespond ONLY with valid JSON:\n\n{\n  \"weeklyPlan\": [\n    {\n      \"day\": 1,\n      \"trainingDay\": true/false,\n      \"meals\": {\n        \"breakfast\": { \"name\": \"string\", \"calories\": number, \"carbs\": number, \"protein\": number, \"fat\": number },\n        \"preWorkout\": { \"name\": \"string\", \"calories\": number, \"timing\": \"string\" },\n        \"postWorkout\": { \"name\": \"string\", \"calories\": number, \"timing\": \"string\" },\n        \"lunch\": { \"name\": \"string\", \"calories\": number, \"carbs\": number, \"protein\": number, \"fat\": number },\n        \"snack\": { \"name\": \"string\", \"calories\": number, \"carbs\": number, \"protein\": number, \"fat\": number },\n        \"dinner\": { \"name\": \"string\", \"calories\": number, \"carbs\": number, \"protein\": number, \"fat\": number }\n      },\n      \"dailyTotals\": { \"calories\": number, \"carbs\": number, \"protein\": number, \"fat\": number }\n    }\n  ],\n  \"shoppingList\": [\"ingredient1\", \"ingredient2\"],\n  \"prepTips\": [\"tip1\", \"tip2\"]\n}\n\nDO NOT OUTPUT ANYTHING OTHER THAN VALID JSON.`;\n  }\n\n  // Build daily nutrition prompt for Claude\n  buildDailyNutritionPrompt(userData) {\n    var _trainingData$todaysA5, _trainingData$todaysA6, _trainingData$todaysA7;\n    const {\n      athlete,\n      trainingData,\n      activities,\n      preferences\n    } = userData;\n    return `Provide today's specific nutrition guidance for this athlete.\n\nATHLETE: ${athlete === null || athlete === void 0 ? void 0 : athlete.firstname} (${(athlete === null || athlete === void 0 ? void 0 : athlete.weight) || 70}kg)\nTODAY'S TRAINING: ${trainingData === null || trainingData === void 0 ? void 0 : (_trainingData$todaysA5 = trainingData.todaysActivity) === null || _trainingData$todaysA5 === void 0 ? void 0 : _trainingData$todaysA5.type} - ${trainingData === null || trainingData === void 0 ? void 0 : (_trainingData$todaysA6 = trainingData.todaysActivity) === null || _trainingData$todaysA6 === void 0 ? void 0 : _trainingData$todaysA6.duration} min at ${trainingData === null || trainingData === void 0 ? void 0 : (_trainingData$todaysA7 = trainingData.todaysActivity) === null || _trainingData$todaysA7 === void 0 ? void 0 : _trainingData$todaysA7.intensity} intensity\n\nRECENT TRAINING PATTERN:\n${activities === null || activities === void 0 ? void 0 : activities.slice(0, 3).map(activity => `${activity.date}: ${activity.type}, ${activity.intensity} intensity`).join('\\n')}\n\nCONTEXT: ${trainingData === null || trainingData === void 0 ? void 0 : trainingData.currentPhase} phase, ${trainingData === null || trainingData === void 0 ? void 0 : trainingData.weeklyTSS} weekly TSS\n\nProvide specific guidance for TODAY based on their actual training. Be practical and actionable.\n\nRespond ONLY with valid JSON:\n\n{\n  \"preWorkout\": {\n    \"timing\": \"specific timing before workout\",\n    \"meal\": \"specific food recommendation\",\n    \"rationale\": \"why this works for today's training\"\n  },\n  \"duringWorkout\": {\n    \"strategy\": \"specific fueling strategy\",\n    \"details\": \"what to consume and when\"\n  },\n  \"postWorkout\": {\n    \"timing\": \"specific timing after workout\", \n    \"meal\": \"specific recovery meal\",\n    \"focus\": \"what this meal accomplishes\"\n  },\n  \"hydrationGoal\": \"specific hydration target for today\",\n  \"racePrep\": \"any race-specific nutrition notes\"\n}\n\nDO NOT OUTPUT ANYTHING OTHER THAN VALID JSON.`;\n  }\n\n  // Keep all your existing fallback methods unchanged...\n  generateIntelligentMockPlan(userData) {\n    const {\n      athlete,\n      trainingData,\n      activities,\n      preferences\n    } = userData;\n    const goal = (preferences === null || preferences === void 0 ? void 0 : preferences.trainingGoal) || 'Endurance Performance';\n\n    // Calculate calories based on actual training load\n    const baseCalories = this.calculateBaseCalories(athlete);\n    const trainingAdjustment = this.calculateTrainingAdjustment(trainingData, activities, goal);\n    const dailyCalories = Math.round(baseCalories + trainingAdjustment);\n\n    // Adjust macros based on training phase AND goal\n    const macros = this.calculateMacros(dailyCalories, trainingData.currentPhase, goal);\n\n    // Generate phase-specific recommendations\n    const phaseRecommendations = this.getPhaseRecommendations(trainingData.currentPhase, goal);\n    return {\n      dailyCalories,\n      macros,\n      hydration: {\n        dailyTarget: Math.round(35 * (athlete.weight || 70)),\n        duringTraining: `${Math.round(trainingData.todaysActivity.duration * 8)}ml per hour`,\n        recoveryFocus: goal === 'Weight Loss' ? 'Focus on electrolyte balance without excess calories' : 'Rapid rehydration with added carbohydrates'\n      },\n      workoutNutrition: {\n        preWorkout: this.getPreWorkoutNutrition(trainingData.todaysActivity.intensity, goal),\n        duringWorkout: this.getDuringWorkoutNutrition(trainingData.todaysActivity.duration, trainingData.todaysActivity.intensity),\n        postWorkout: this.getPostWorkoutNutrition(trainingData.todaysActivity.intensity, goal)\n      },\n      mealSuggestions: [{\n        meal: \"Breakfast\",\n        description: \"Oatmeal with berries and Greek yogurt\",\n        calories: Math.round(dailyCalories * 0.25),\n        timing: \"2-3 hours before training\"\n      }],\n      supplements: this.getSupplementRecommendations(trainingData.currentPhase, goal),\n      notes: `FALLBACK MODE: Based on your ${trainingData.currentPhase} training phase and ${goal.toLowerCase()} goal. ${phaseRecommendations}`\n    };\n  }\n  generateMockDailyNutrition(userData) {\n    const {\n      athlete,\n      trainingData\n    } = userData;\n    return {\n      preWorkout: {\n        timing: \"1-2 hours before\",\n        meal: \"Banana with almond butter and coffee\",\n        rationale: `FALLBACK MODE: Given your ${trainingData.todaysActivity.intensity.toLowerCase()} intensity session`\n      },\n      duringWorkout: {\n        strategy: trainingData.todaysActivity.duration > 60 ? \"Sports drink with 30-60g carbs/hour\" : \"Water only\",\n        details: \"Start fueling after 45-60 minutes\"\n      },\n      postWorkout: {\n        timing: \"Within 30 minutes\",\n        meal: \"Protein shake with banana\",\n        focus: \"Rapid recovery and glycogen replenishment\"\n      },\n      hydrationGoal: `${Math.round(35 * (athlete.weight || 70))}ml base + training needs`,\n      racePrep: \"FALLBACK MODE: Focus on consistent daily nutrition habits\"\n    };\n  }\n  generateMockMealPlan(userData, nutritionPlan) {\n    return {\n      weeklyPlan: [{\n        day: 1,\n        trainingDay: true,\n        meals: {\n          breakfast: {\n            name: \"FALLBACK: Training Day Oatmeal\",\n            calories: 450,\n            carbs: 65,\n            protein: 15,\n            fat: 12\n          },\n          lunch: {\n            name: \"FALLBACK: Quinoa Power Bowl\",\n            calories: 520,\n            carbs: 68,\n            protein: 22,\n            fat: 18\n          },\n          dinner: {\n            name: \"FALLBACK: Salmon with Sweet Potato\",\n            calories: 580,\n            carbs: 45,\n            protein: 35,\n            fat: 22\n          }\n        },\n        dailyTotals: {\n          calories: nutritionPlan.dailyCalories,\n          carbs: nutritionPlan.macros.carbs.grams,\n          protein: nutritionPlan.macros.protein.grams,\n          fat: nutritionPlan.macros.fat.grams\n        }\n      }],\n      shoppingList: [\"oats\", \"banana\", \"salmon\", \"sweet potato\"],\n      prepTips: [\"FALLBACK MODE: Prep overnight oats\", \"Cook grains in batches\"]\n    };\n  }\n\n  // Keep all your existing helper methods (calculateBaseCalories, etc.)\n  calculateBaseCalories(athlete) {\n    const weight = athlete.weight || 70;\n    const age = athlete.age || 35;\n    const height = athlete.height || 175;\n    const isMale = athlete.sex === 'M';\n    if (isMale) {\n      return 10 * weight + 6.25 * height - 5 * age + 5;\n    } else {\n      return 10 * weight + 6.25 * height - 5 * age - 161;\n    }\n  }\n  calculateTrainingAdjustment(trainingData, activities, goal) {\n    var _trainingData$todaysA8;\n    const baseTSS = (trainingData === null || trainingData === void 0 ? void 0 : (_trainingData$todaysA8 = trainingData.todaysActivity) === null || _trainingData$todaysA8 === void 0 ? void 0 : _trainingData$todaysA8.tss) || 0;\n    const weeklyAverage = (trainingData === null || trainingData === void 0 ? void 0 : trainingData.weeklyTSS) / 7 || 0;\n    let adjustment = baseTSS * 15;\n    if (goal === 'Weight Loss') {\n      adjustment *= 0.8;\n    } else if (goal === 'Performance') {\n      adjustment *= 1.1;\n    }\n    return adjustment;\n  }\n  calculateMacros(calories, phase, goal) {\n    let carbPercentage = 55;\n    let proteinPercentage = 20;\n    let fatPercentage = 25;\n    if (phase === 'Build' || phase === 'Peak') {\n      carbPercentage = 60;\n      proteinPercentage = 20;\n      fatPercentage = 20;\n    } else if (phase === 'Recovery') {\n      carbPercentage = 50;\n      proteinPercentage = 25;\n      fatPercentage = 25;\n    }\n    if (goal === 'Weight Loss') {\n      carbPercentage -= 5;\n      proteinPercentage += 5;\n    }\n    return {\n      carbs: {\n        grams: Math.round(calories * carbPercentage / 100 / 4),\n        percentage: carbPercentage,\n        timing: \"Focus around training sessions\"\n      },\n      protein: {\n        grams: Math.round(calories * proteinPercentage / 100 / 4),\n        percentage: proteinPercentage,\n        timing: \"Spread throughout the day, emphasize post-workout\"\n      },\n      fat: {\n        grams: Math.round(calories * fatPercentage / 100 / 9),\n        percentage: fatPercentage,\n        timing: \"Away from immediate pre/post workout windows\"\n      }\n    };\n  }\n  getPhaseRecommendations(phase, goal) {\n    const recommendations = {\n      'Build': 'Focus on adequate carbohydrate intake to support increased training load.',\n      'Peak': 'Maintain energy with consistent nutrition timing. Practice race-day nutrition.',\n      'Recovery': 'Emphasize protein for tissue repair and lighter, nutrient-dense meals.',\n      'Base': 'Build healthy eating habits with balanced macronutrient distribution.'\n    };\n    return recommendations[phase] || recommendations['Base'];\n  }\n  getPreWorkoutNutrition(intensity, goal) {\n    if (intensity === 'High' || intensity === 'Very High') {\n      return goal === 'Weight Loss' ? 'Light carbs: banana or small energy bar' : 'Carb-rich: oatmeal with banana and honey';\n    }\n    return 'Light snack if needed: banana or toast';\n  }\n  getDuringWorkoutNutrition(duration, intensity) {\n    if (duration > 90 && (intensity === 'High' || intensity === 'Very High')) {\n      return 'Sports drink: 30-60g carbs per hour after first hour';\n    } else if (duration > 60) {\n      return 'Light sports drink or water with electrolytes';\n    }\n    return 'Water only';\n  }\n  getPostWorkoutNutrition(intensity, goal) {\n    if (intensity === 'High' || intensity === 'Very High') {\n      return goal === 'Weight Loss' ? 'Protein shake with minimal carbs' : 'Recovery shake: 3:1 carb to protein ratio';\n    }\n    return 'Balanced meal within 2 hours';\n  }\n  getSupplementRecommendations(phase, goal) {\n    const base = [{\n      name: 'Vitamin D3',\n      dosage: '2000 IU',\n      timing: 'With breakfast',\n      purpose: 'Bone health and immune function'\n    }, {\n      name: 'Omega-3',\n      dosage: '1000mg EPA/DHA',\n      timing: 'With dinner',\n      purpose: 'Anti-inflammatory support'\n    }];\n    if (phase === 'Build' || phase === 'Peak') {\n      base.push({\n        name: 'Magnesium',\n        dosage: '400mg',\n        timing: 'Before bed',\n        purpose: 'Muscle recovery and sleep quality'\n      });\n    }\n    return base;\n  }\n}\n\n// Create and export instance\nconst nutritionService = new NutritionService();\nexport default nutritionService;","map":{"version":3,"names":["NutritionService","constructor","proxyUrl","process","env","REACT_APP_PROXY_URL","model","callClaude","prompt","maxTokens","console","log","response","fetch","method","headers","body","JSON","stringify","max_tokens","messages","role","content","ok","errorData","json","catch","Error","status","error","data","responseText","text","cleanedResponse","replace","trim","parse","testConnection","healthUrl","hasApiKey","generateNutritionPlan","userData","buildNutritionPrompt","generateIntelligentMockPlan","generateWeeklyMealPlan","nutritionPlan","buildMealPlanPrompt","generateMockMealPlan","generateDailyNutrition","buildDailyNutritionPrompt","generateMockDailyNutrition","_trainingData$todaysA","_trainingData$todaysA2","_trainingData$todaysA3","_trainingData$todaysA4","athlete","trainingData","activities","preferences","firstname","lastname","weight","sex","age","height","currentPhase","weeklyTSS","todaysActivity","type","duration","intensity","tss","slice","map","activity","date","join","trainingGoal","dietaryRestrictions","dailyCalories","macros","carbs","grams","percentage","protein","fat","index","cookingSkill","_trainingData$todaysA5","_trainingData$todaysA6","_trainingData$todaysA7","goal","baseCalories","calculateBaseCalories","trainingAdjustment","calculateTrainingAdjustment","Math","round","calculateMacros","phaseRecommendations","getPhaseRecommendations","hydration","dailyTarget","duringTraining","recoveryFocus","workoutNutrition","preWorkout","getPreWorkoutNutrition","duringWorkout","getDuringWorkoutNutrition","postWorkout","getPostWorkoutNutrition","mealSuggestions","meal","description","calories","timing","supplements","getSupplementRecommendations","notes","toLowerCase","rationale","strategy","details","focus","hydrationGoal","racePrep","weeklyPlan","day","trainingDay","meals","breakfast","name","lunch","dinner","dailyTotals","shoppingList","prepTips","isMale","_trainingData$todaysA8","baseTSS","weeklyAverage","adjustment","phase","carbPercentage","proteinPercentage","fatPercentage","recommendations","base","dosage","purpose","push","nutritionService"],"sources":["/Users/scottyd/Code/trainfuel_cleaned/src/services/nutritionService.js"],"sourcesContent":["// src/services/nutritionService.js\nclass NutritionService {\n  constructor() {\n    // Use proxy server instead of direct API calls\n    this.proxyUrl = process.env.REACT_APP_PROXY_URL || \"http://localhost:3001/api/claude\";\n    this.model = \"claude-sonnet-4-20250514\";\n  }\n\n  // Make API call to Claude via proxy server\n  async callClaude(prompt, maxTokens = 2000) {\n    try {\n      console.log('Making request to proxy server:', this.proxyUrl);\n      \n      const response = await fetch(this.proxyUrl, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          model: this.model,\n          max_tokens: maxTokens,\n          messages: [\n            { role: \"user\", content: prompt }\n          ]\n        })\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(`Proxy request failed: ${response.status} - ${errorData.error || 'Unknown error'}`);\n      }\n\n      const data = await response.json();\n      const responseText = data.content[0].text;\n      \n      // Clean response and parse JSON\n      const cleanedResponse = responseText.replace(/```json\\n?/g, \"\").replace(/```\\n?/g, \"\").trim();\n      return JSON.parse(cleanedResponse);\n      \n    } catch (error) {\n      console.error('Claude API Error:', error);\n      throw error;\n    }\n  }\n\n  // Test proxy connection\n  async testConnection() {\n    try {\n      const healthUrl = this.proxyUrl.replace('/api/claude', '/health');\n      const response = await fetch(healthUrl);\n      const data = await response.json();\n      \n      console.log('Proxy server health:', data);\n      return data.status === 'OK' && data.hasApiKey;\n    } catch (error) {\n      console.error('Proxy connection test failed:', error);\n      return false;\n    }\n  }\n\n  // Generate personalized nutrition plan using Claude\n  async generateNutritionPlan(userData) {\n    console.log('Generating nutrition plan for:', userData);\n    \n    try {\n      const prompt = this.buildNutritionPrompt(userData);\n      const response = await this.callClaude(prompt, 2000);\n      console.log('✅ Received Claude nutrition plan');\n      return response;\n      \n    } catch (error) {\n      console.error('❌ Error generating nutrition plan:', error);\n      console.log('🔄 Falling back to intelligent mock data');\n      // Fallback to intelligent mock data\n      return this.generateIntelligentMockPlan(userData);\n    }\n  }\n\n  // Generate weekly meal plan using Claude\n  async generateWeeklyMealPlan(userData, nutritionPlan) {\n    console.log('Generating weekly meal plan for:', userData);\n    \n    try {\n      const prompt = this.buildMealPlanPrompt(userData, nutritionPlan);\n      const response = await this.callClaude(prompt, 3000);\n      console.log('✅ Received Claude meal plan');\n      return response;\n      \n    } catch (error) {\n      console.error('❌ Error generating meal plan:', error);\n      console.log('🔄 Falling back to mock meal plan');\n      // Fallback to mock meal plan\n      return this.generateMockMealPlan(userData, nutritionPlan);\n    }\n  }\n\n  // Generate daily nutrition recommendations using Claude\n  async generateDailyNutrition(userData) {\n    console.log('Generating daily nutrition for:', userData);\n    \n    try {\n      const prompt = this.buildDailyNutritionPrompt(userData);\n      const response = await this.callClaude(prompt, 1500);\n      console.log('✅ Received Claude daily nutrition');\n      return response;\n      \n    } catch (error) {\n      console.error('❌ Error generating daily nutrition:', error);\n      console.log('🔄 Falling back to mock daily nutrition');\n      // Fallback to mock daily nutrition\n      return this.generateMockDailyNutrition(userData);\n    }\n  }\n\n  // Build detailed nutrition plan prompt for Claude\n  buildNutritionPrompt(userData) {\n    const { athlete, trainingData, activities, preferences } = userData;\n    \n    return `Create a personalized nutrition plan based on the following athlete data.\n\nATHLETE PROFILE:\n- Name: ${athlete?.firstname} ${athlete?.lastname}\n- Weight: ${athlete?.weight || preferences.weight || 70}kg\n- Gender: ${athlete?.sex === 'M' ? 'Male' : athlete?.sex === 'F' ? 'Female' : 'Unknown'}\n- Age: ${preferences.age || 35}\n- Height: ${preferences.height || 175}cm\n\nCURRENT TRAINING DATA:\n- Training Phase: ${trainingData?.currentPhase}\n- Weekly TSS: ${trainingData?.weeklyTSS}\n- Recent Activity: ${trainingData?.todaysActivity?.type} (${trainingData?.todaysActivity?.duration} min, ${trainingData?.todaysActivity?.intensity} intensity, ${trainingData?.todaysActivity?.tss} TSS)\n\nRECENT ACTIVITIES (Last 7 days):\n${activities?.slice(0, 7).map(activity => \n  `- ${activity.date}: ${activity.type}, ${activity.duration} min, ${activity.intensity} intensity, ${activity.tss} TSS`\n).join('\\n')}\n\nGOALS & PREFERENCES:\n- Primary Goal: ${preferences.trainingGoal || 'Endurance Performance'}\n- Dietary Restrictions: ${preferences.dietaryRestrictions || 'None'}\n\nCONTEXT: This athlete is actively training with real Strava data. Analyze their training patterns, intensity distribution, and current phase to provide highly specific nutrition recommendations.\n\nRespond ONLY with valid JSON in this exact format:\n\n{\n  \"dailyCalories\": number,\n  \"macros\": {\n    \"carbs\": { \"grams\": number, \"percentage\": number, \"timing\": \"specific timing recommendations\" },\n    \"protein\": { \"grams\": number, \"percentage\": number, \"timing\": \"specific timing recommendations\" },\n    \"fat\": { \"grams\": number, \"percentage\": number, \"timing\": \"specific timing recommendations\" }\n  },\n  \"hydration\": {\n    \"dailyTarget\": number,\n    \"duringTraining\": \"specific ml per hour based on training duration\",\n    \"recoveryFocus\": \"specific hydration strategy\"\n  },\n  \"workoutNutrition\": {\n    \"preWorkout\": \"specific food and timing based on upcoming workout\",\n    \"duringWorkout\": \"specific fueling strategy for their training intensity\", \n    \"postWorkout\": \"specific recovery nutrition with timing\"\n  },\n  \"mealSuggestions\": [\n    {\n      \"meal\": \"Breakfast\",\n      \"description\": \"specific meal based on training schedule\",\n      \"calories\": number,\n      \"timing\": \"specific timing relative to training\"\n    },\n    {\n      \"meal\": \"Pre-Training\",\n      \"description\": \"specific pre-workout meal\",\n      \"calories\": number,\n      \"timing\": \"specific timing\"\n    },\n    {\n      \"meal\": \"Post-Training\",\n      \"description\": \"specific recovery meal\",\n      \"calories\": number,\n      \"timing\": \"specific timing\"\n    },\n    {\n      \"meal\": \"Dinner\",\n      \"description\": \"specific dinner based on training load\",\n      \"calories\": number,\n      \"timing\": \"specific timing\"\n    }\n  ],\n  \"supplements\": [\n    {\n      \"name\": \"supplement name\",\n      \"dosage\": \"specific dosage\",\n      \"timing\": \"specific timing\",\n      \"purpose\": \"specific purpose for this athlete's training\"\n    }\n  ],\n  \"notes\": \"Key insights about this athlete's specific training phase, recent activities, and personalized recommendations\"\n}\n\nDO NOT OUTPUT ANYTHING OTHER THAN VALID JSON.`;\n  }\n\n  // Build meal plan prompt for Claude\n  buildMealPlanPrompt(userData, nutritionPlan) {\n    const { athlete, trainingData, activities, preferences } = userData;\n    \n    return `Create a 7-day meal plan based on this athlete's nutrition plan and training schedule.\n\nATHLETE: ${athlete?.firstname} (${athlete?.weight || 70}kg)\nNUTRITION TARGETS:\n- Daily Calories: ${nutritionPlan.dailyCalories}\n- Carbs: ${nutritionPlan.macros.carbs.grams}g (${nutritionPlan.macros.carbs.percentage}%)\n- Protein: ${nutritionPlan.macros.protein.grams}g (${nutritionPlan.macros.protein.percentage}%)\n- Fat: ${nutritionPlan.macros.fat.grams}g (${nutritionPlan.macros.fat.percentage}%)\n\nTRAINING PATTERN (analyze for meal timing):\n${activities?.slice(0, 7).map((activity, index) => \n  `Day ${index + 1}: ${activity.type}, ${activity.duration}min, ${activity.intensity} intensity`\n).join('\\n')}\n\nPREFERENCES:\n- Dietary Restrictions: ${preferences.dietaryRestrictions || 'None'}\n- Cooking Skill: ${preferences.cookingSkill || 'Intermediate'}\n\nCreate meals that:\n1. Match training demands (higher carbs on hard training days)\n2. Optimize timing around workouts\n3. Meet nutritional targets\n4. Are practical and enjoyable\n\nRespond ONLY with valid JSON:\n\n{\n  \"weeklyPlan\": [\n    {\n      \"day\": 1,\n      \"trainingDay\": true/false,\n      \"meals\": {\n        \"breakfast\": { \"name\": \"string\", \"calories\": number, \"carbs\": number, \"protein\": number, \"fat\": number },\n        \"preWorkout\": { \"name\": \"string\", \"calories\": number, \"timing\": \"string\" },\n        \"postWorkout\": { \"name\": \"string\", \"calories\": number, \"timing\": \"string\" },\n        \"lunch\": { \"name\": \"string\", \"calories\": number, \"carbs\": number, \"protein\": number, \"fat\": number },\n        \"snack\": { \"name\": \"string\", \"calories\": number, \"carbs\": number, \"protein\": number, \"fat\": number },\n        \"dinner\": { \"name\": \"string\", \"calories\": number, \"carbs\": number, \"protein\": number, \"fat\": number }\n      },\n      \"dailyTotals\": { \"calories\": number, \"carbs\": number, \"protein\": number, \"fat\": number }\n    }\n  ],\n  \"shoppingList\": [\"ingredient1\", \"ingredient2\"],\n  \"prepTips\": [\"tip1\", \"tip2\"]\n}\n\nDO NOT OUTPUT ANYTHING OTHER THAN VALID JSON.`;\n  }\n\n  // Build daily nutrition prompt for Claude\n  buildDailyNutritionPrompt(userData) {\n    const { athlete, trainingData, activities, preferences } = userData;\n    \n    return `Provide today's specific nutrition guidance for this athlete.\n\nATHLETE: ${athlete?.firstname} (${athlete?.weight || 70}kg)\nTODAY'S TRAINING: ${trainingData?.todaysActivity?.type} - ${trainingData?.todaysActivity?.duration} min at ${trainingData?.todaysActivity?.intensity} intensity\n\nRECENT TRAINING PATTERN:\n${activities?.slice(0, 3).map(activity => \n  `${activity.date}: ${activity.type}, ${activity.intensity} intensity`\n).join('\\n')}\n\nCONTEXT: ${trainingData?.currentPhase} phase, ${trainingData?.weeklyTSS} weekly TSS\n\nProvide specific guidance for TODAY based on their actual training. Be practical and actionable.\n\nRespond ONLY with valid JSON:\n\n{\n  \"preWorkout\": {\n    \"timing\": \"specific timing before workout\",\n    \"meal\": \"specific food recommendation\",\n    \"rationale\": \"why this works for today's training\"\n  },\n  \"duringWorkout\": {\n    \"strategy\": \"specific fueling strategy\",\n    \"details\": \"what to consume and when\"\n  },\n  \"postWorkout\": {\n    \"timing\": \"specific timing after workout\", \n    \"meal\": \"specific recovery meal\",\n    \"focus\": \"what this meal accomplishes\"\n  },\n  \"hydrationGoal\": \"specific hydration target for today\",\n  \"racePrep\": \"any race-specific nutrition notes\"\n}\n\nDO NOT OUTPUT ANYTHING OTHER THAN VALID JSON.`;\n  }\n\n  // Keep all your existing fallback methods unchanged...\n  generateIntelligentMockPlan(userData) {\n    const { athlete, trainingData, activities, preferences } = userData;\n    const goal = preferences?.trainingGoal || 'Endurance Performance';\n    \n    // Calculate calories based on actual training load\n    const baseCalories = this.calculateBaseCalories(athlete);\n    const trainingAdjustment = this.calculateTrainingAdjustment(trainingData, activities, goal);\n    const dailyCalories = Math.round(baseCalories + trainingAdjustment);\n    \n    // Adjust macros based on training phase AND goal\n    const macros = this.calculateMacros(dailyCalories, trainingData.currentPhase, goal);\n    \n    // Generate phase-specific recommendations\n    const phaseRecommendations = this.getPhaseRecommendations(trainingData.currentPhase, goal);\n    \n    return {\n      dailyCalories,\n      macros,\n      hydration: {\n        dailyTarget: Math.round(35 * (athlete.weight || 70)),\n        duringTraining: `${Math.round(trainingData.todaysActivity.duration * 8)}ml per hour`,\n        recoveryFocus: goal === 'Weight Loss' ? \n          'Focus on electrolyte balance without excess calories' : \n          'Rapid rehydration with added carbohydrates'\n      },\n      workoutNutrition: {\n        preWorkout: this.getPreWorkoutNutrition(trainingData.todaysActivity.intensity, goal),\n        duringWorkout: this.getDuringWorkoutNutrition(trainingData.todaysActivity.duration, trainingData.todaysActivity.intensity),\n        postWorkout: this.getPostWorkoutNutrition(trainingData.todaysActivity.intensity, goal)\n      },\n      mealSuggestions: [\n        {\n          meal: \"Breakfast\",\n          description: \"Oatmeal with berries and Greek yogurt\",\n          calories: Math.round(dailyCalories * 0.25),\n          timing: \"2-3 hours before training\"\n        }\n      ],\n      supplements: this.getSupplementRecommendations(trainingData.currentPhase, goal),\n      notes: `FALLBACK MODE: Based on your ${trainingData.currentPhase} training phase and ${goal.toLowerCase()} goal. ${phaseRecommendations}`\n    };\n  }\n\n  generateMockDailyNutrition(userData) {\n    const { athlete, trainingData } = userData;\n    \n    return {\n      preWorkout: {\n        timing: \"1-2 hours before\",\n        meal: \"Banana with almond butter and coffee\",\n        rationale: `FALLBACK MODE: Given your ${trainingData.todaysActivity.intensity.toLowerCase()} intensity session`\n      },\n      duringWorkout: {\n        strategy: trainingData.todaysActivity.duration > 60 ? \"Sports drink with 30-60g carbs/hour\" : \"Water only\",\n        details: \"Start fueling after 45-60 minutes\"\n      },\n      postWorkout: {\n        timing: \"Within 30 minutes\",\n        meal: \"Protein shake with banana\",\n        focus: \"Rapid recovery and glycogen replenishment\"\n      },\n      hydrationGoal: `${Math.round(35 * (athlete.weight || 70))}ml base + training needs`,\n      racePrep: \"FALLBACK MODE: Focus on consistent daily nutrition habits\"\n    };\n  }\n\n  generateMockMealPlan(userData, nutritionPlan) {\n    return {\n      weeklyPlan: [\n        {\n          day: 1,\n          trainingDay: true,\n          meals: {\n            breakfast: { name: \"FALLBACK: Training Day Oatmeal\", calories: 450, carbs: 65, protein: 15, fat: 12 },\n            lunch: { name: \"FALLBACK: Quinoa Power Bowl\", calories: 520, carbs: 68, protein: 22, fat: 18 },\n            dinner: { name: \"FALLBACK: Salmon with Sweet Potato\", calories: 580, carbs: 45, protein: 35, fat: 22 }\n          },\n          dailyTotals: { calories: nutritionPlan.dailyCalories, carbs: nutritionPlan.macros.carbs.grams, protein: nutritionPlan.macros.protein.grams, fat: nutritionPlan.macros.fat.grams }\n        }\n      ],\n      shoppingList: [\"oats\", \"banana\", \"salmon\", \"sweet potato\"],\n      prepTips: [\"FALLBACK MODE: Prep overnight oats\", \"Cook grains in batches\"]\n    };\n  }\n\n  // Keep all your existing helper methods (calculateBaseCalories, etc.)\n  calculateBaseCalories(athlete) {\n    const weight = athlete.weight || 70;\n    const age = athlete.age || 35;\n    const height = athlete.height || 175;\n    const isMale = athlete.sex === 'M';\n    \n    if (isMale) {\n      return (10 * weight) + (6.25 * height) - (5 * age) + 5;\n    } else {\n      return (10 * weight) + (6.25 * height) - (5 * age) - 161;\n    }\n  }\n\n  calculateTrainingAdjustment(trainingData, activities, goal) {\n    const baseTSS = trainingData?.todaysActivity?.tss || 0;\n    const weeklyAverage = trainingData?.weeklyTSS / 7 || 0;\n    \n    let adjustment = baseTSS * 15;\n    \n    if (goal === 'Weight Loss') {\n      adjustment *= 0.8;\n    } else if (goal === 'Performance') {\n      adjustment *= 1.1;\n    }\n    \n    return adjustment;\n  }\n\n  calculateMacros(calories, phase, goal) {\n    let carbPercentage = 55;\n    let proteinPercentage = 20;\n    let fatPercentage = 25;\n    \n    if (phase === 'Build' || phase === 'Peak') {\n      carbPercentage = 60;\n      proteinPercentage = 20;\n      fatPercentage = 20;\n    } else if (phase === 'Recovery') {\n      carbPercentage = 50;\n      proteinPercentage = 25;\n      fatPercentage = 25;\n    }\n    \n    if (goal === 'Weight Loss') {\n      carbPercentage -= 5;\n      proteinPercentage += 5;\n    }\n    \n    return {\n      carbs: {\n        grams: Math.round((calories * carbPercentage / 100) / 4),\n        percentage: carbPercentage,\n        timing: \"Focus around training sessions\"\n      },\n      protein: {\n        grams: Math.round((calories * proteinPercentage / 100) / 4),\n        percentage: proteinPercentage,\n        timing: \"Spread throughout the day, emphasize post-workout\"\n      },\n      fat: {\n        grams: Math.round((calories * fatPercentage / 100) / 9),\n        percentage: fatPercentage,\n        timing: \"Away from immediate pre/post workout windows\"\n      }\n    };\n  }\n\n  getPhaseRecommendations(phase, goal) {\n    const recommendations = {\n      'Build': 'Focus on adequate carbohydrate intake to support increased training load.',\n      'Peak': 'Maintain energy with consistent nutrition timing. Practice race-day nutrition.',\n      'Recovery': 'Emphasize protein for tissue repair and lighter, nutrient-dense meals.',\n      'Base': 'Build healthy eating habits with balanced macronutrient distribution.'\n    };\n    \n    return recommendations[phase] || recommendations['Base'];\n  }\n\n  getPreWorkoutNutrition(intensity, goal) {\n    if (intensity === 'High' || intensity === 'Very High') {\n      return goal === 'Weight Loss' ? \n        'Light carbs: banana or small energy bar' :\n        'Carb-rich: oatmeal with banana and honey';\n    }\n    return 'Light snack if needed: banana or toast';\n  }\n\n  getDuringWorkoutNutrition(duration, intensity) {\n    if (duration > 90 && (intensity === 'High' || intensity === 'Very High')) {\n      return 'Sports drink: 30-60g carbs per hour after first hour';\n    } else if (duration > 60) {\n      return 'Light sports drink or water with electrolytes';\n    }\n    return 'Water only';\n  }\n\n  getPostWorkoutNutrition(intensity, goal) {\n    if (intensity === 'High' || intensity === 'Very High') {\n      return goal === 'Weight Loss' ?\n        'Protein shake with minimal carbs' :\n        'Recovery shake: 3:1 carb to protein ratio';\n    }\n    return 'Balanced meal within 2 hours';\n  }\n\n  getSupplementRecommendations(phase, goal) {\n    const base = [\n      { name: 'Vitamin D3', dosage: '2000 IU', timing: 'With breakfast', purpose: 'Bone health and immune function' },\n      { name: 'Omega-3', dosage: '1000mg EPA/DHA', timing: 'With dinner', purpose: 'Anti-inflammatory support' }\n    ];\n    \n    if (phase === 'Build' || phase === 'Peak') {\n      base.push({\n        name: 'Magnesium',\n        dosage: '400mg',\n        timing: 'Before bed',\n        purpose: 'Muscle recovery and sleep quality'\n      });\n    }\n    \n    return base;\n  }\n}\n\n// Create and export instance\nconst nutritionService = new NutritionService();\nexport default nutritionService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}